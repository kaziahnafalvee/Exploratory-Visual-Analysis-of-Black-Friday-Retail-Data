
<!DOCTYPE html>
<meta charset="utf-8">
<html>
<head>
  <title>Black Friday Spend Explorer</title>
  <style>
    body {
      font-family: sans-serif;
    }
    .tooltip {
      position: absolute;
      text-align: center;
      padding: 6px;
      font-size: 14px;
      background: white;
      border: 1px solid #ccc;
      pointer-events: none;
      border-radius: 4px;
      box-shadow: 0px 0px 4px rgba(0,0,0,0.1);
    }
    .center-label {
      text-anchor: middle;
      font-size: 18px;
      fill: #333;
    }
  </style>
</head>
<body>
<h2>Black Friday Spend Explorer</h2>
<p>Click to zoom into segments. Hover to see purchase values.</p>
<div id="chart"></div>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script>

// Set dimensions
const width = 700;
const radius = width / 2;

const format = d3.format(",d");
const color = d3.scaleOrdinal(d3.schemeCategory10);

// Create tooltip
const tooltip = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);

// Create SVG
const svg = d3.select("#chart")
  .append("svg")
    .attr("viewBox", [0, 0, width, width])
  .append("g")
    .attr("transform", `translate(${radius},${radius})`);

// Partition layout
const partition = data => {
  const root = d3.hierarchy(data)
      .sum(d => d.value || 0)
      .sort((a, b) => b.value - a.value);
  return d3.partition()
      .size([2 * Math.PI, root.height + 1])
    (root);
};

// Arc generator
const arc = d3.arc()
    .startAngle(d => d.x0)
    .endAngle(d => d.x1)
    .innerRadius(d => d.y0 * radius / 4)
    .outerRadius(d => d.y1 * radius / 4 - 1);

// Load JSON data
d3.json("black_friday_hierarchy.json").then(data => {
  const root = partition(data);
  root.each(d => d.current = d);

  const path = svg.append("g")
    .selectAll("path")
    .data(root.descendants().slice(1))
    .join("path")
      .attr("fill", d => color((d.children ? d : d.parent).data.name))
      .attr("d", d => arc(d.current))
      .on("mouseover", (event, d) => {
        tooltip.transition().duration(200).style("opacity", 0.9);
        tooltip.html(`<strong>${d.data.name}</strong><br/>${format(d.value)}`)
               .style("left", (event.pageX + 10) + "px")
               .style("top", (event.pageY - 28) + "px");
      })
      .on("mouseout", () => tooltip.transition().duration(500).style("opacity", 0))
      .on("click", clicked);

  // Add center label
  svg.append("text")
    .attr("class", "center-label")
    .attr("dy", "0.35em")
    .text("Total");

  function clicked(event, p) {
    root.each(d => d.target = {
      x0: Math.max(0, Math.min(1, (d.x0 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
      x1: Math.max(0, Math.min(1, (d.x1 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
      y0: Math.max(0, d.y0 - p.y0),
      y1: Math.max(0, d.y1 - p.y0)
    });

    const t = svg.transition().duration(750);
    path.transition(t)
        .tween("data", d => {
          const i = d3.interpolate(d.current, d.target);
          return t => d.current = i(t);
        })
        .attrTween("d", d => () => arc(d.current));
  }
});

</script>
</body>
</html>
